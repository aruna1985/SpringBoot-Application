node{
def mvnHome
 	
 		stage('getSCM'){
 		 			git 'https://github.com/aruna1985/SpringBoot-Application.git'
 		 			 		
 		 }
 		 stage('Build'){
 		 			echo'this is build maven artifact'
 		 			mvnHome=tool 'Maven'
 		 			def mvnCmd="${mvnHome}/bin/mvn"
 		 			sh "${mvnCmd} clean package"

 		 }
 		 stage('Build Docker image'){
 		 	sh 'docker build -t arunaraja/dockerspringboot:1.0 .'
 		 }
 		 stage('push docker to Dockerhub'){
 		 	withCredentials([string(credentialsId: 'dockerpwd', variable: 'dockerhubpwd')]) {
 		 		sh "docker login -u arunaraja -p ${dockerhubpwd}"
 		 	}
 		 	sh 'docker push arunaraja/dockerspringboot:1.0'
 		 }
 		 stage('Run container on Dev server'){
 		 	def containerName="dockerspringboot"
 		 	def previousContainer="${docker ps --all --quiet --filter=name="$containerName"}"
 		 	if[-n "$previousContainer"]; then
 		 		docker stop $previousContainer && docker rm $previousContainer 
 		 	def dockerRun='docker run -p 8081:8181 --name dockerspringboot arunaraja/dockerspringboot:1.0'
 		 	sshagent(['tomcat-dev']) {
       			  sh "ssh -o StrictHostKeyChecking=no ec2-user@172.31.9.254 ${dockerRun}"
 		 	}
 		}
 	}
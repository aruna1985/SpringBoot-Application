node{
def mvnHome
 	
 		stage('getSCM'){
 		 			git 'https://github.com/aruna1985/SpringBoot-Application.git'
 		 			 		
 		 }
 		 stage('Build'){
 		 			echo'this is build maven artifact'
 		 			mvnHome=tool 'Maven'
 		 			def mvnCmd="${mvnHome}/bin/mvn"
 		 			sh "${mvnCmd} clean package"

 		 }
 		 stage('Build Docker image'){
 		 	sh 'docker build -t arunaraja/dockerspringboot:1.0 .'
 		 }
 		 stage('push docker to Dockerhub'){
 		 	withCredentials([string(credentialsId: 'dockerpwd', variable: 'dockerhubpwd')]) {
 		 		sh "docker login -u arunaraja -p ${dockerhubpwd}"
 		 	}
 		 	sh 'docker push arunaraja/dockerspringboot:1.0'
 		 }
 		 stage('Run container on Dev server'){
 		 	def dockerRun='docker run -p 8081:8080 -d --name mywebapplication arunaraja/dockerspringboot:1.0'
 		 	sshagent(['tomcat-dev']) {
       			  sh "scp -o StrictHostKeyChecking=no ec2-52-66-9-212.ap-south-1.compute.amazonaws.com ${dockerRun}"
 		 	}
 		}
 	}